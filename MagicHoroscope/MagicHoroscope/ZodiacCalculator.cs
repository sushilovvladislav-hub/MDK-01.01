using System;
using System.Collections.Generic;
using System.Linq;

namespace MagicHoroscope
{
    internal class ZodiacCalculator
    {
        private readonly List<ZodiacSign> _zodiacSigns;
        private readonly Dictionary<string, string> _elementDescriptions;

        public ZodiacCalculator() 
        {
            _elementDescriptions = InitializeElementDescriptions();
            _zodiacSigns = InitializeZodiacSigns();
        }

        private Dictionary<string, string> InitializeElementDescriptions()
        {
            return new Dictionary<string, string>
            {
                { "Огонь", "Огненные знаки энергичны, страстны и импульсивны. Они обладают сильной волей и стремлением к лидерству." },
                { "Земля", "Земные знаки практичны, надежны и стабильны. Они ценят материальные блага и реалистичный подход к жизни." },
                { "Воздух", "Воздушные знаки интеллектуальны, общительны и любопытны. Они стремятся к общению и обмену идеями." },
                { "Вода", "Водные знаки эмоциональны, интуитивны и чувствительны. Они глубоко чувствуют и понимают эмоции других." }

            };
        }

        private List<ZodiacSign> InitializeZodiacSigns()
        {
            return new List<ZodiacSign>
            {
                new ZodiacSign("Овен", "Огонь", "Под этим знаком появляются на свет неутомимые борцы и неисправимые оптимисты. Их упрямство достойно войти в пословицы. Чего Овны не любят – так это слишком долго заниматься одним делом: уж слишком быстро они «перегорают». И в любви все так же: вспышка страсти, головокружительный роман, а затем – охлаждение и поиски нового партнера.", 3, 21, 4, 19),
                new ZodiacSign("Телец", "Земля", "Тельцы совершенно уверены, что появились на свет для того, чтобы сделать мир лучше, и в этом они почти не ошибаются. Способность Тельцов украшать и приукрашивать удивительна. Там, где за дело берутся представители этого знака, вскоре не остается ничего, что бы не радовало глаз и не поднимало настроения. Но доброжелательные Тельцы становятся совершенно безжалостными, когда кто-то пытается обидеть их близких.", 4, 20, 5, 20),
                new ZodiacSign("Близнецы", "Воздух", "Близнецы многолики, переменчивы и непредсказуемы. С ними всегда весело и интересно, но очень редко бывает спокойно. Рутина – главный враг Близнецов, над которыми они регулярно одерживают верх. Представители знака наделены незаурядными артистическими талантами. Если Близнецы случайно не работают в театре, значит, в театр превратится вся их жизнь.", 5, 21, 6, 20),
                new ZodiacSign("Рак", "Вода", "Стихия Раков – душевные порывы, тонкие переживания, высокие чувства. Все грубое и материальное представляется им малоинтересным; исключением являются деньги и красивые вещи – против них Раки ничего не имеют. Семья для Раков – всегда приоритет. О благополучии своих близких представители знака позаботятся в любых обстоятельствах.", 6, 21, 7, 22),
                new ZodiacSign("Лев", "Огонь", "Львов невозможно не заметить: везде, где появляются представители знака, они оказываются в центре внимания. От простых смертных Львов отличает безупречный вкус, а также искренняя (и взаимная) любовь к роскоши. Можно не любить Льва, но не любоваться им невозможно. Неожиданностью для многих оказывается то, что за яркой внешностью скрывается ранимая душа.", 7, 23, 8, 22),
                new ZodiacSign("Дева", "Земля", "Считается, что именно под знаком Девы появляются на свет самые умные люди. Они не только отличаются незаурядным интеллектом, но и умеют сказать твердое и решительное «нет» тем чувствам и эмоциям, которые считают ненужными. Дева способна создать прочную и счастливую семью, но едва ли будет чувствовать себя несчастной, если останется в одиночестве: представители знака самодостаточны.", 8, 23, 9, 22),
                new ZodiacSign("Весы", "Воздух", "Считается, что Весы нерешительны, но это совсем не так. Они просто принимают во внимание многие факторы – в том числе те, которых не замечают представители других знаков, и именно поэтому часто проводят время в размышлениях. Кроме того, представители знака отличаются хорошими манерами, дружелюбием и оптимизмом. Только очень терпеливый и настойчивый человек способен испортить Весам настроение.", 9, 23, 10, 22),
                new ZodiacSign("Скорпион", "Вода", "Скорпионы – сложные, многогранные и очень привлекательные люди. Они способны очаровать любого, но никогда не делают этого в корыстных целях. Личная жизнь Скорпионов отличается крайней насыщенностью, ведь именно в водовороте страстей представители данного знака чувствуют себя наиболее комфортно. Кроме того, сменяющие друг друга бурные романы помогают им избегать даже кратких периодов одиночества – а его Скорпионы ужасно не любят.", 10, 23, 11, 21),
                new ZodiacSign("Стрелец", "Огонь", "Азарт – вот сила, которая ведет Стрельцов по жизни, порой приводя в сложные, нелепые и смешные ситуации. Стрельцы не боятся проблем  и неудач; более того – чем более сложная задача стоит перед представителями знака, тем с большим воодушевлением они берутся за ее решение. Быть другом Стрельца – одно удовольствие, любить Стрельца – другое, но ничуть не меньшее. Неудивительно, что Стрельцы всегда окружены теми, кто готов ради них на что угодно.", 11, 22, 12, 21),
                new ZodiacSign("Козерог", "Земля", "Трудолюбие, здравомыслие и правильная оценка собственных возможностей – три кита успеха Козерогов. Благодаря этим качествам представители знака справляются со всеми жизненными трудностями и добиваются поставленных целей. Козероги не склонны к легкомыслию и неоправданному оптимизму; более того, часто они видят свою жизнь в самом мрачном свете, хотя она далеко не плоха.", 12, 22, 1, 19),
                new ZodiacSign("Водолей", "Воздух", "Водолеи очень самостоятельны и самодостаточны. Конечно, у них есть друзья, родственники, просто близкие люди, но, честно говоря, никто не понимает представителей знака до конца. Ход мысли Водолея всегда на удивление извилист, и без подробных объяснений никак не поймешь, почему же Водолею удалось прийти к правильному выводу, да еще и сделать  это на удивление быстро. У представителей знака очень сильная интуиция, но пользоваться ею правильно им не всегда удается.", 1, 20, 2, 18),
                new ZodiacSign("Рыбы", "Вода", "У Рыб легкий, приятный характер, слегка окрашенный в романтические или меланхолические тона. Представители знака не отличаются большой жизненной энергией или выдающимся стоицизмом и предпочитают пережидать трудные времена за чьими-нибудь широкими плечами, но на это никто не жалуется. У Рыб огромный запас душевного тепла, поэтому они способны растопить даже ледяное сердце.", 2, 19, 3, 20)
            };
        }

        public ZodiacSign GetSignByDate(DateTime birthDate)
        {
            int month = birthDate.Month;
            int day = birthDate.Day;

            foreach (var sign in _zodiacSigns)
            {
                if(IsDateInRange(month, day, sign))
                {
                    return sign;
                }
            }
            return null;
        }

        private bool IsDateInRange(int month, int day, ZodiacSign sign)
        {
        
            DateTime currentDate = new DateTime(2000, month, day);
            DateTime startDate = new DateTime(2000, sign.StartMonth, sign.StartDay);
            DateTime endDate = new DateTime(2000, sign.EndMonth, sign.EndDay);

            if (endDate < startDate)
                endDate = endDate.AddYears(1);

            if (currentDate < startDate)
                currentDate = currentDate.AddYears(1);

            return currentDate >= startDate && currentDate <= endDate;
        
        }

        public string GetElementDescription(string element)
        {
            return _elementDescriptions.TryGetValue(element, out var description) ? description : string.Empty;
        }

    }
}
